# ğŸ›¡ï¸ Studio Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERACTION                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Client Component    â”‚
                    â”‚  (generation-panel,   â”‚
                    â”‚   new/page, etc.)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Validation   â”‚             â”‚  No Validation  â”‚
        â”‚   (Optional)   â”‚             â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                               â”‚
                â”‚ âœ… Valid                      â”‚
                â”‚                               â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Server Action      â”‚
              â”‚  (lib/studio/        â”‚
              â”‚   actions.ts)        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Success â”‚                    â”‚  Error  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â”‚                               â–¼
         â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚   ChatSDKError       â”‚
         â”‚                    â”‚  (typed error with   â”‚
         â”‚                    â”‚   code & message)    â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚   Thrown to client   â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Client Catch Block  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Success â”‚          â”‚  Error  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚showStudioSuccessâ”‚    â”‚ showStudioError      â”‚
â”‚                â”‚    â”‚  (error-handler.ts)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚
        â”‚                        â–¼
        â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚ handleStudioError    â”‚
        â”‚             â”‚  - Detect type       â”‚
        â”‚             â”‚  - Get context       â”‚
        â”‚             â”‚  - Format message    â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Toast (Sonner)â”‚
        â”‚  - Title         â”‚
        â”‚  - Description   â”‚
        â”‚  - Duration      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   USER SEES     â”‚
        â”‚ ERROR MESSAGE   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Error Types Flow

```
ErrorType              Surface                 ErrorCode
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
bad_request     +     studio_project    =    bad_request:studio_project
unauthorized    +     studio_asset      =    unauthorized:studio_asset
forbidden       +     studio_generation =    forbidden:studio_generation
not_found       +     studio_template   =    not_found:studio_template
rate_limit      +     fal_api          =    rate_limit:fal_api
offline         +     file_upload      =    offline:file_upload
```

## ğŸ”„ Server Action Flow (Detailed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Server Action (generateAction)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  1. getCurrentUser()                                      â”‚
â”‚     â”œâ”€â”€ âŒ No user â†’ redirect("/login")                  â”‚
â”‚     â””â”€â”€ âœ… User exists                                    â”‚
â”‚                                                           â”‚
â”‚  2. Validate Model                                        â”‚
â”‚     â”œâ”€â”€ âŒ Not found â†’ ChatSDKError("not_found:fal_api") â”‚
â”‚     â””â”€â”€ âœ… Model exists                                   â”‚
â”‚                                                           â”‚
â”‚  3. Validate Prompt (if text-to-*)                       â”‚
â”‚     â”œâ”€â”€ âŒ Empty â†’ ChatSDKError("bad_request:...")       â”‚
â”‚     â”œâ”€â”€ âŒ Too long â†’ ChatSDKError("bad_request:...")    â”‚
â”‚     â””â”€â”€ âœ… Valid                                          â”‚
â”‚                                                           â”‚
â”‚  4. Validate Project (if provided)                       â”‚
â”‚     â”œâ”€â”€ âŒ Not found â†’ ChatSDKError("not_found:...")     â”‚
â”‚     â”œâ”€â”€ âŒ No access â†’ ChatSDKError("forbidden:...")     â”‚
â”‚     â””â”€â”€ âœ… Valid                                          â”‚
â”‚                                                           â”‚
â”‚  5. Create Generation Record                             â”‚
â”‚     â”œâ”€â”€ âŒ Rate limit â†’ ChatSDKError("rate_limit:...")   â”‚
â”‚     â”œâ”€â”€ âŒ DB error â†’ ChatSDKError("bad_request:...")    â”‚
â”‚     â””â”€â”€ âœ… Created                                        â”‚
â”‚                                                           â”‚
â”‚  6. Start Background Processing                          â”‚
â”‚     â””â”€â”€ processGeneration() async                        â”‚
â”‚                                                           â”‚
â”‚  7. Return Response                                      â”‚
â”‚     â””â”€â”€ { generationId, status: "pending" }             â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Background Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        processGeneration() - Background Task              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  1. Update status â†’ "processing"                         â”‚
â”‚                                                           â”‚
â”‚  2. Call fal.ai API                                      â”‚
â”‚     â”œâ”€â”€ getFalClient()                                   â”‚
â”‚     â”œâ”€â”€ falClient.run(modelId, input)                   â”‚
â”‚     â”‚   â”œâ”€â”€ submit() â†’ queue                            â”‚
â”‚     â”‚   â””â”€â”€ poll status until complete                  â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€â”€ Handle fal.ai errors:                           â”‚
â”‚         â”œâ”€â”€ timeout â†’ "Generation timeout"              â”‚
â”‚         â”œâ”€â”€ rate limit â†’ "Rate limit exceeded"          â”‚
â”‚         â”œâ”€â”€ auth â†’ "Authentication failed"              â”‚
â”‚         â”œâ”€â”€ invalid â†’ "Invalid parameters"              â”‚
â”‚         â”œâ”€â”€ not found â†’ "Model not found"               â”‚
â”‚         â””â”€â”€ offline â†’ "Service unavailable"             â”‚
â”‚                                                           â”‚
â”‚  3. Process Result                                       â”‚
â”‚     â”œâ”€â”€ Extract output URL                              â”‚
â”‚     â”œâ”€â”€ Extract metadata                                 â”‚
â”‚     â””â”€â”€ Calculate processing time                        â”‚
â”‚                                                           â”‚
â”‚  4. Create Asset                                         â”‚
â”‚     â”œâ”€â”€ createAsset() with output URL                   â”‚
â”‚     â””â”€â”€ âŒ Error â†’ log but continue                     â”‚
â”‚                                                           â”‚
â”‚  5. Update Generation                                    â”‚
â”‚     â”œâ”€â”€ âœ… Success â†’ status: "completed"                â”‚
â”‚     â”‚              outputAssetId                         â”‚
â”‚     â”‚              processingTime                        â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€â”€ âŒ Error â†’ status: "failed"                     â”‚
â”‚                    error: detailed message               â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Client Component Flow (generation-panel-v2)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              handleGenerate() - User Click                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Client Validation                                        â”‚
â”‚  â”œâ”€â”€ No model selected?                                  â”‚
â”‚  â”‚   â””â”€â”€ toast.error("Please select a model")           â”‚
â”‚  â”œâ”€â”€ No prompt (if needed)?                              â”‚
â”‚  â”‚   â””â”€â”€ toast.error("Prompt required")                 â”‚
â”‚  â””â”€â”€ Missing required inputs?                            â”‚
â”‚      â””â”€â”€ toast.error("Missing required inputs")          â”‚
â”‚                                                           â”‚
â”‚  âœ… All validations passed                               â”‚
â”‚                                                           â”‚
â”‚  setIsGenerating(true)                                   â”‚
â”‚                                                           â”‚
â”‚  try {                                                   â”‚
â”‚    const response = await generateAction(request)       â”‚
â”‚                                                           â”‚
â”‚    // Success!                                           â”‚
â”‚    showStudioSuccess(                                    â”‚
â”‚      "Generation started!",                              â”‚
â”‚      "Your content is being generated"                   â”‚
â”‚    )                                                     â”‚
â”‚    onGenerationStart?.(response.generationId)           â”‚
â”‚                                                           â”‚
â”‚    // Reset form                                         â”‚
â”‚    setPrompt("")                                         â”‚
â”‚    setNegativePrompt("")                                 â”‚
â”‚    setReferenceInputs({ ... })                          â”‚
â”‚                                                           â”‚
â”‚  } catch (error) {                                       â”‚
â”‚    // Error handling                                     â”‚
â”‚    showStudioError(error, "generation")                 â”‚
â”‚    â””â”€â”€ Automatic context-aware error display            â”‚
â”‚  }                                                       â”‚
â”‚                                                           â”‚
â”‚  finally {                                               â”‚
â”‚    setIsGenerating(false)                                â”‚
â”‚  }                                                       â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ­ Error Handler Decision Tree

```
                    Error Caught
                         â”‚
                         â–¼
              Is ChatSDKError?
                    â•±    â•²
                  â•±        â•²
               Yes          No
                â”‚            â”‚
                â–¼            â–¼
       Use error.type    Parse message
       Use error.surface    keywords
       Use error.message      â”‚
                â”‚              â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              Determine ErrorType
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
    rate_limit    not_found    unauthorized
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
   "Rate limit    "Not found"   "Sign in
    exceeded"                    required"
        â”‚              â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              Add Context Info
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚          â”‚          â”‚
        project    generation   asset
            â”‚          â”‚          â”‚
            â–¼          â–¼          â–¼
     "...projects" "...quota"  "...assets"
            â”‚          â”‚          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              Format Toast
              {
                title: "...",
                description: "...",
                action: "..."
              }
                       â”‚
                       â–¼
              Display to User
```

## ğŸ“± User Experience Flow

```
User Action â†’ Client Validation â†’ Server Validation â†’ Processing â†’ Result
                    â”‚                     â”‚               â”‚          â”‚
                    â–¼                     â–¼               â–¼          â–¼
              Error Toast          Error Toast      Status Update  Success Toast
              (instant)            (few ms)         (polling)      (on complete)
```

---

**Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°:**
- âœ… Success path
- âŒ Error path
- â–¼ Flow direction
- â”œâ”€â”€ Branch
- â””â”€â”€ End of branch
